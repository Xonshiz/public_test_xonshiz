name: Create Python Release

on: push
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Initialize Python 3.7
      uses: actions/setup-python@v1
      with:
        python-version: 3.7
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    - name: Build Dist
      run: |
        python cli.py --version
        pyinstaller --onefile --hidden-import=queue "cli.py" -n "comic_dl_linux"
        chmod +x dist/comic_dl_linux
        dist/comic_dl_linux --version
    - name: Generate Release Tag
      run: |
        echo ::set-env name=RELEASE_TAG_NAME::$(dist/comic_dl_linux --version | grep '^Current Version\s+:\s+(.*?)$')
    - name: GH Release
      uses: softprops/action-gh-release@v0.1.14
      with:
        files: dist/comic_dl_linux
      tag_name: ${{ env.RELEASE_TAG_NAME }}