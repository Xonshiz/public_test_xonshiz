name: Create Python Release For Windows

on: push
jobs:
  release:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@master
    - name: Initialize Python 3.7
      uses: actions/setup-python@v1
      with:
        python-version: 3.7
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    - name: Build Dist
      run: |
        python cli.py --version
        pyinstaller --onefile --hidden-import=queue "cli.py" -n "comic_dl.exe"
        dist/omic_dl.exe --version
    - name: Generate Release Tag
      id: tag
      run: |
        echo "::set-output name=release_tag::$(dist/omic_dl.exe --version | grep '^Current Version\s+:\s+(.*?)$')"
    - name: GH Release
      uses: softprops/action-gh-release@v0.1.14
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ steps.tag.outputs.release_tag }}
        files: dist/omic_dl.exe